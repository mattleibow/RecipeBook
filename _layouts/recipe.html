---
layout: default
---

<div class="row">
    <div class="col-md-8 mx-auto">
        <article class="recipe-article">
            <!-- Recipe Title -->
            <header class="text-center mb-4">
                <h1 class="display-4 mb-3">{{ page.title | default: "Recipe" }}</h1>
                {% if page.date %}
                <p class="text-muted">{{ page.date | date: "%B %d, %Y" }}</p>
                {% endif %}
            </header>

            <!-- Recipe Content -->
            <div class="recipe-content">
                {{ content }}
            </div>

            <!-- Recipe Navigation -->
            <nav class="recipe-nav mt-5 pt-4 border-top">
                <div class="row">
                    <div class="col-6">
                        {% if page.previous %}
                        <a href="{{ page.previous.url | relative_url }}" class="btn btn-outline-secondary">
                            &larr; Previous Recipe
                        </a>
                        {% endif %}
                    </div>
                    <div class="col-6 text-end">
                        {% if page.next %}
                        <a href="{{ page.next.url | relative_url }}" class="btn btn-outline-secondary">
                            Next Recipe &rarr;
                        </a>
                        {% endif %}
                    </div>
                </div>
                <div class="text-center mt-3">
                    <a href="{{ '/' | relative_url }}" class="btn btn-primary">Back to Recipe Journal</a>
                </div>
            </nav>
        </article>
    </div>
</div>

<style>
/* Unit conversion tabs styling */
.unit-tabs {
    display: flex;
    background-color: #f8f9fa;
    border-radius: 8px;
    padding: 4px;
    margin: 15px 0;
    justify-content: center;
}

.unit-tab {
    flex: 1;
    text-align: center;
    padding: 8px 12px;
    border: none;
    background: transparent;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: 500;
}

.unit-tab:hover {
    background-color: #e9ecef;
}

.unit-tab.active {
    background-color: #007bff;
    color: white;
}

.ingredient-conversion {
    display: none;
}

.ingredient-conversion.active {
    display: inline;
}

.original-measurement {
    color: #6c757d;
    font-size: 0.85em;
    margin-left: 5px;
}

@media (max-width: 576px) {
    .unit-tabs {
        flex-direction: column;
    }
    
    .unit-tab {
        margin: 2px 0;
    }
}
</style>

<script>
// Unit conversion data
const ingredientConversions = {
    // Flour (all-purpose) - 1 cup = 120g = 4.23oz
    'flour': { gramsPerCup: 120, densityFactor: 1 },
    'all-purpose flour': { gramsPerCup: 120, densityFactor: 1 },
    'bread flour': { gramsPerCup: 127, densityFactor: 1 },
    'cake flour': { gramsPerCup: 114, densityFactor: 1 },
    'whole wheat flour': { gramsPerCup: 113, densityFactor: 1 },
    
    // Sugar - 1 cup granulated = 200g = 7.05oz
    'sugar': { gramsPerCup: 200, densityFactor: 1 },
    'granulated sugar': { gramsPerCup: 200, densityFactor: 1 },
    'white sugar': { gramsPerCup: 200, densityFactor: 1 },
    'brown sugar': { gramsPerCup: 213, densityFactor: 1 },
    'powdered sugar': { gramsPerCup: 120, densityFactor: 1 },
    'confectioners sugar': { gramsPerCup: 120, densityFactor: 1 },
    
    // Butter - 1 cup = 227g = 8oz
    'butter': { gramsPerCup: 227, densityFactor: 1 },
    'unsalted butter': { gramsPerCup: 227, densityFactor: 1 },
    'salted butter': { gramsPerCup: 227, densityFactor: 1 },
    
    // Other common baking ingredients
    'cocoa powder': { gramsPerCup: 85, densityFactor: 1 },
    'baking powder': { gramsPerCup: 192, densityFactor: 1 },
    'baking soda': { gramsPerCup: 220, densityFactor: 1 },
    'cornstarch': { gramsPerCup: 120, densityFactor: 1 },
    'rolled oats': { gramsPerCup: 90, densityFactor: 1 },
    'coconut': { gramsPerCup: 85, densityFactor: 1 },
    'shredded coconut': { gramsPerCup: 85, densityFactor: 1 },
    
    // Nuts and seeds
    'almonds': { gramsPerCup: 143, densityFactor: 1 },
    'walnuts': { gramsPerCup: 117, densityFactor: 1 },
    'pecans': { gramsPerCup: 99, densityFactor: 1 },
    
    // Common pantry items that benefit from weight
    'rice': { gramsPerCup: 185, densityFactor: 1 },
    'quinoa': { gramsPerCup: 170, densityFactor: 1 },
    'breadcrumbs': { gramsPerCup: 108, densityFactor: 1 }
};

// Items that should stay as volume (liquids and very small amounts)
const volumeOnlyIngredients = [
    'milk', 'water', 'oil', 'vegetable oil', 'olive oil', 'broth', 'stock', 
    'wine', 'beer', 'cream', 'heavy cream', 'sour cream', 'yogurt',
    'honey', 'maple syrup', 'vanilla extract', 'almond extract',
    'lemon juice', 'lime juice', 'vinegar', 'soy sauce',
    'salt', 'pepper', 'garlic powder', 'onion powder'
];

function parseIngredientLine(text) {
    // Match patterns like "2 cups flour", "1½ teaspoons salt", "¼ cup butter"
    const measurementRegex = /^(\d+(?:[½⅓⅔¼¾⅛⅜⅝⅞]|\.\d+|\/\d+)?)\s+(cups?|tablespoons?|tbsp|teaspoons?|tsp|pounds?|lbs?|ounces?|oz)\s+(.+)$/i;
    const match = text.match(measurementRegex);
    
    if (!match) return null;
    
    let [, amount, unit, ingredient] = match;
    
    // Handle fractions properly
    amount = amount.replace(/(\d+)?([½⅓⅔¼¾⅛⅜⅝⅞])/, (match, whole, frac) => {
        const fractions = {'½': 0.5, '⅓': 0.333, '⅔': 0.667, '¼': 0.25, '¾': 0.75, '⅛': 0.125, '⅜': 0.375, '⅝': 0.625, '⅞': 0.875};
        const wholeNum = whole ? parseInt(whole) : 0;
        return (wholeNum + fractions[frac]).toString();
    });
    
    // Handle simple fractions like 1/4, 1/2
    if (amount.includes('/')) {
        const [num, denom] = amount.split('/').map(n => parseInt(n));
        amount = (num / denom).toString();
    }
    
    return {
        amount: parseFloat(amount),
        unit: unit.toLowerCase(),
        ingredient: ingredient.trim(),
        originalText: text
    };
}

function shouldConvertToWeight(ingredient) {
    const lowerIngredient = ingredient.toLowerCase();
    
    // Check if it's in volume-only list
    if (volumeOnlyIngredients.some(item => lowerIngredient.includes(item.toLowerCase()))) {
        return false;
    }
    
    // Check if we have conversion data
    return Object.keys(ingredientConversions).some(key => lowerIngredient.includes(key.toLowerCase()));
}

function getConversionData(ingredient) {
    const lowerIngredient = ingredient.toLowerCase();
    for (const [key, data] of Object.entries(ingredientConversions)) {
        if (lowerIngredient.includes(key.toLowerCase())) {
            return data;
        }
    }
    return null;
}

function convertToGrams(amount, unit, ingredient) {
    const conversionData = getConversionData(ingredient);
    if (!conversionData) return null;
    
    let gramsAmount = 0;
    
    switch (unit) {
        case 'cup':
        case 'cups':
            gramsAmount = amount * conversionData.gramsPerCup;
            break;
        case 'tablespoon':
        case 'tablespoons':
        case 'tbsp':
            gramsAmount = amount * (conversionData.gramsPerCup / 16);
            break;
        case 'teaspoon':
        case 'teaspoons':
        case 'tsp':
            gramsAmount = amount * (conversionData.gramsPerCup / 48);
            break;
        default:
            return null;
    }
    
    return Math.round(gramsAmount);
}

function convertToOunces(grams) {
    return (grams / 28.35).toFixed(1);
}

function createConversionHTML(originalText, parsed, grams) {
    const ounces = convertToOunces(grams);
    
    return `
        <span class="ingredient-conversion metric active">${grams}g ${parsed.ingredient}</span>
        <span class="ingredient-conversion imperial">${ounces}oz ${parsed.ingredient}</span>
        <span class="ingredient-conversion volume">${originalText}</span>
        <span class="original-measurement">(${originalText})</span>
    `;
}

function addUnitTabs() {
    // Find all ingredients sections
    const ingredientsSections = document.querySelectorAll('.ingredients-section');
    
    ingredientsSections.forEach(section => {
        // Check if this section has convertible ingredients
        const listItems = section.querySelectorAll('li');
        let hasConvertibleIngredients = false;
        
        listItems.forEach(li => {
            const text = li.textContent.trim();
            const parsed = parseIngredientLine(text);
            
            if (parsed && shouldConvertToWeight(parsed.ingredient)) {
                const grams = convertToGrams(parsed.amount, parsed.unit, parsed.ingredient);
                if (grams) {
                    hasConvertibleIngredients = true;
                    li.innerHTML = createConversionHTML(text, parsed, grams);
                }
            }
        });
        
        // Add tabs if we have convertible ingredients
        if (hasConvertibleIngredients) {
            const tabsHTML = `
                <div class="unit-tabs">
                    <button class="unit-tab active" data-unit="metric">Metric (g)</button>
                    <button class="unit-tab" data-unit="imperial">Imperial (oz)</button>
                    <button class="unit-tab" data-unit="volume">Volume (cups)</button>
                </div>
            `;
            section.insertAdjacentHTML('beforebegin', tabsHTML);
        }
    });
    
    // Add tab functionality
    document.querySelectorAll('.unit-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const unit = this.dataset.unit;
            const tabGroup = this.parentElement;
            const ingredientsSection = tabGroup.nextElementSibling;
            
            // Update active tab
            tabGroup.querySelectorAll('.unit-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Update visible conversions
            ingredientsSection.querySelectorAll('.ingredient-conversion').forEach(conv => {
                conv.classList.remove('active');
            });
            ingredientsSection.querySelectorAll(`.ingredient-conversion.${unit}`).forEach(conv => {
                conv.classList.add('active');
            });
            
            // Show/hide original measurements
            const originalMeasurements = ingredientsSection.querySelectorAll('.original-measurement');
            originalMeasurements.forEach(orig => {
                orig.style.display = unit === 'volume' ? 'none' : 'inline';
            });
        });
    });
}

// Add styling classes to content sections
document.addEventListener('DOMContentLoaded', function() {
    // Style story sections
    const storyHeadings = document.querySelectorAll('h2');
    storyHeadings.forEach(heading => {
        if (heading.textContent.toLowerCase().includes('story') || 
            heading.textContent.toLowerCase().includes('beginning') ||
            heading.textContent.toLowerCase().includes('comfort') ||
            heading.textContent.toLowerCase().includes('connection')) {
            let content = heading.nextElementSibling;
            while (content && content.tagName !== 'H2') {
                if (content.tagName === 'P') {
                    if (!content.closest('.recipe-story')) {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'recipe-story';
                        content.parentNode.insertBefore(wrapper, content);
                        wrapper.appendChild(heading);
                        while (wrapper.nextElementSibling && wrapper.nextElementSibling.tagName !== 'H2') {
                            wrapper.appendChild(wrapper.nextElementSibling);
                        }
                        break;
                    }
                }
                content = content.nextElementSibling;
            }
        }
    });

    // Style ingredients sections
    const ingredientsHeadings = document.querySelectorAll('h2, h3');
    ingredientsHeadings.forEach(heading => {
        if (heading.textContent.toLowerCase().includes('ingredient')) {
            let section = heading.nextElementSibling;
            while (section && section.tagName !== 'H2') {
                if (section.tagName === 'UL') {
                    section.classList.add('ingredients-section');
                }
                section = section.nextElementSibling;
            }
        }
    });

    // Style instructions sections
    const instructionsHeadings = document.querySelectorAll('h2, h3');
    instructionsHeadings.forEach(heading => {
        if (heading.textContent.toLowerCase().includes('instruction')) {
            let section = heading.nextElementSibling;
            while (section && section.tagName !== 'H2') {
                if (section.tagName === 'OL' || section.tagName === 'UL') {
                    section.classList.add('instructions-section');
                }
                section = section.nextElementSibling;
            }
        }
    });

    // Style tips sections
    const tipsHeadings = document.querySelectorAll('h2, h3');
    tipsHeadings.forEach(heading => {
        if (heading.textContent.toLowerCase().includes('tip')) {
            let section = heading.nextElementSibling;
            while (section && section.tagName !== 'H2') {
                if (section.tagName === 'UL' || section.tagName === 'P') {
                    section.classList.add('tips-section');
                }
                section = section.nextElementSibling;
            }
        }
    });
    
    // Add unit conversion tabs after all sections are styled
    addUnitTabs();
});
</script>